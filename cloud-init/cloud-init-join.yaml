#cloud-config
package_update: true
write_files:
  - path: /etc/rancher/rke2/config.yaml
    owner: root
    content: |
      token: my-shared-secret
      server: https://rke2master:9345
      tls-san:
        - rke2b.lol
        - rke2b
        - rke2master.lol
        - rke2master
  - path: /etc/hosts
    owner: root
    content: |
      127.0.0.1 localhost
      10.0.1.2 rke2a
      10.0.1.3 rke2b 
      10.0.1.4 rke2c
      10.0.1.5 rke2master

      # The following lines are desirable for IPv6 capable hosts
      ::1 ip6-localhost ip6-loopback
      fe00::0 ip6-localnet
      ff00::0 ip6-mcastprefix
      ff02::1 ip6-allnodes
      ff02::2 ip6-allrouters
      ff02::3 ip6-allhosts
packages:
  - qemu-guest-agent
runcmd:
  - - systemctl
    - enable
    - '--now'
    - qemu-guest-agent.service
  - curl -sfL https://get.rke2.io | INSTALL_RKE2_CHANNEL=v1.20 sh -
  - systemctl enable rke2-server.service
  - systemctl start rke2-server.service